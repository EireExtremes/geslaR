<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="geslaR">
<title>Dealing with the GESLA dataset in R • geslaR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dealing with the GESLA dataset in R">
<meta property="og:description" content="geslaR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">geslaR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1-0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/intro-to-arrow.html">Introduction to Apache Arrow framework</a>
    <a class="dropdown-item" href="../articles/intro-to-geslaR.html">Dealing with the GESLA dataset in R</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/EireExtremes/geslaR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Dealing with the GESLA dataset in R</h1>
                        <h4 data-toc-skip class="author">Fernando Mayer,
Niamh Cahill</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/EireExtremes/geslaR/blob/HEAD/vignettes/intro-to-geslaR.Rmd" class="external-link"><code>vignettes/intro-to-geslaR.Rmd</code></a></small>
      <div class="d-none name"><code>intro-to-geslaR.Rmd</code></div>
    </div>

    
    
<p>The <strong>geslaR</strong> package was designed to fetch the <a href="https://gesla787883612.wordpress.com" class="external-link">GESLA</a> dataset into R, as
a full dataset or as a subset of the data. There a few ways that this
can be achieved:</p>
<ul>
<li>Downloading the entire dataset locally, then loading it into R and
working from there using the <a href="https://arrow.apache.org" class="external-link">Apache
Arrow</a> framework (<code><a href="../reference/download_gesla.html">download_gesla()</a></code>)</li>
<li>Querying the hosted dataset directly from R, specifying the desired
subset (<code><a href="../reference/query_gesla.html">query_gesla()</a></code>)</li>
<li>Using the GESLA Shiny app (thereafter called only geslaR-app), to
filter, visualise and possibly download subsets of the dataset
(<code><a href="../reference/run_gesla_app.html">run_gesla_app()</a></code>)</li>
</ul>
<p>In the sections below, we will discuss each of these
possibilities.</p>
<div class="section level2">
<h2 id="loading-the-package">Loading the package<a class="anchor" aria-label="anchor" href="#loading-the-package"></a>
</h2>
<p>When you first load the <strong>geslaR</strong> package into an R
session, two more packages will automatically be loaded:
<strong>arrow</strong> and <strong>dplyr</strong>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/EireExtremes/geslaR" class="external-link">geslaR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: arrow</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'arrow'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     timestamp</span></span>
<span><span class="co">#&gt; Loading required package: dplyr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<p>These two packages are strictly necessary for dealing with a huge
dataset like GESLA, to alleviate the need to load it in memory all at
once. The full GESLA dataset has more than 1.7 billion lines, and is
nearly impossible to load it in R (or any other RAM memory language,
like e.g. Python) all at once. To avoid this problem, there are two
possibilities:</p>
<ol style="list-style-type: decimal">
<li>Load (smaller) subsets of the full dataset</li>
<li>Use an “in-memory” analytics framework</li>
</ol>
<p>In the best case scenario, these two approaches can be used together
for maximum efficiency, and the <strong>geslaR</strong> package was
designed to achieve this.</p>
<p>Regardless the way the GESLA data is loaded into R, the best way to
deal with it is using the <a href="https://arrow.apache.org" class="external-link">Apache
Arrow</a> framework. For a more detailed explanation and examples,
please see the <code><a href="../articles/intro-to-arrow.html">vignette("intro-to-arrow")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="downloading-the-full-gesla-dataset">Downloading the full GESLA dataset<a class="anchor" aria-label="anchor" href="#downloading-the-full-gesla-dataset"></a>
</h2>
<p>If you want to explore the full GESLA dataset, you can download it
with the <code><a href="../reference/download_gesla.html">download_gesla()</a></code> function as follows</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_gesla.html">download_gesla</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will create a directory called <code>gesla_dataset</code> in the
current working directory (as defined by <code><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd()</a></code>) and
download the full dataset locally. This download may take some time
(expect around 5 to 10 minutes), as it depends on internet connection.
Note that this full dataset will need at least 7GB of (hard drive)
storage, so make sure this is feasible. However, once downloaded, you
will have access to the full dataset, and you will only need to do this
once.</p>
<p>You will notice that the full dataset is composed of 5119 <a href="https://parquet.apache.org" class="external-link">Apache Parquet</a> files, ending in
<code>.parquet</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Number of downloaded files</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"gesla_dataset"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5119</span></span>
<span><span class="co">## Check the first files</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="st">"gesla_dataset"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "a121-a12-nld-cmems.parquet"      "a2-a2-bel-cmems.parquet"        </span></span>
<span><span class="co">#&gt; [3] "aalesund-aal-nor-cmems.parquet"  "aarhus-aar-dnk-cmems.parquet"   </span></span>
<span><span class="co">#&gt; [5] "aasiaat-aas-grl-gloss.parquet"   "abashiri-347a-jpn-uhslc.parquet"</span></span></code></pre></div>
<p>These files are the same as those originally distributed in the GESLA
dataset, so that each one refers to a site from where the data comes
from. To load this full dataset in R, use the
<code><a href="https://arrow.apache.org/docs/r/reference/open_dataset.html" class="external-link">arrow::open_dataset()</a></code> function, specifying the location of
the <code>.parquet</code> files. Although there are many files, this
function recognises them as a single dataset, because they all have the
same structure (or “Schema”).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Open dataset</span></span>
<span><span class="va">da</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://arrow.apache.org/docs/r/reference/open_dataset.html" class="external-link">open_dataset</a></span><span class="op">(</span><span class="st">"gesla_dataset"</span><span class="op">)</span></span>
<span><span class="co">## Check the object</span></span>
<span><span class="va">da</span></span>
<span><span class="co">#&gt; FileSystemDataset with 5119 Parquet files</span></span>
<span><span class="co">#&gt; date_time: timestamp[us]</span></span>
<span><span class="co">#&gt; year: int64</span></span>
<span><span class="co">#&gt; month: int64</span></span>
<span><span class="co">#&gt; day: int64</span></span>
<span><span class="co">#&gt; hour: int64</span></span>
<span><span class="co">#&gt; country: string</span></span>
<span><span class="co">#&gt; site_name: string</span></span>
<span><span class="co">#&gt; lat: double</span></span>
<span><span class="co">#&gt; lon: double</span></span>
<span><span class="co">#&gt; sea_level: double</span></span>
<span><span class="co">#&gt; qc_flag: int64</span></span>
<span><span class="co">#&gt; use_flag: int64</span></span>
<span><span class="co">#&gt; file_name: string</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; See $metadata for additional Schema metadata</span></span>
<span><span class="co">## Verify class</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">da</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "FileSystemDataset" "Dataset"           "ArrowObject"      </span></span>
<span><span class="co">#&gt; [4] "R6"</span></span></code></pre></div>
<p>Since this is an <code>ArrowObject</code> object, it will actually
not load the full dataset in memory (as it would if it was a standard R
object, such as a <code>tibble</code> or <code>data.frame</code>). Note,
however, that some basic information, such as <code><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim()</a></code> and
<code><a href="https://rdrr.io/r/base/names.html" class="external-link">names()</a></code> can be retrieved simply with</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">da</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1172435674         13</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">da</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "date_time" "year"      "month"     "day"       "hour"      "country"  </span></span>
<span><span class="co">#&gt;  [7] "site_name" "lat"       "lon"       "sea_level" "qc_flag"   "use_flag" </span></span>
<span><span class="co">#&gt; [13] "file_name"</span></span></code></pre></div>
<p>Any other manipulation of the dataset must be made using
<strong>dplyr</strong> verbs. For example, to count the number of
observations by country, one could use</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 113 × 2</span></span>
<span><span class="co">#&gt;    country         n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 BEL       1263467</span></span>
<span><span class="co">#&gt;  2 JPN      74580447</span></span>
<span><span class="co">#&gt;  3 USA     243838504</span></span>
<span><span class="co">#&gt;  4 DNK      36726648</span></span>
<span><span class="co">#&gt;  5 SLV        812230</span></span>
<span><span class="co">#&gt;  6 GBR      76038844</span></span>
<span><span class="co">#&gt;  7 YEM         63362</span></span>
<span><span class="co">#&gt;  8 CAN      67019312</span></span>
<span><span class="co">#&gt;  9 AUS      72441932</span></span>
<span><span class="co">#&gt; 10 EGY        220872</span></span>
<span><span class="co">#&gt; # ℹ 103 more rows</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="querying-subsets-directly-into-r">Querying subsets directly into R<a class="anchor" aria-label="anchor" href="#querying-subsets-directly-into-r"></a>
</h2>
<p>The <code><a href="../reference/query_gesla.html">query_gesla()</a></code> function can be used to load subsets
of the full GESLA dataset into R. This function will connect to the
GESLA dataset hosted on an Amazon AWS S3 bucket, and will automatically
filter the required piece of data. Note that the query may vary, as it
will depend on the size of the required subset and on internet
connection speed.</p>
<p>The selection is made by specifying one or more countries, years and
site names. The only mandatory argument is <code>country</code>, where
it should be a character vector of three-letter <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3" class="external-link">ISO 3166-1
alpha-3</a> codes. If the argument <code>year</code> is empty, then all
available years for those countries will be selected. The same occurs
for the <code>site_name</code> argument.</p>
<p>For example, to select all the available data for Ireland (IRL),
simply use</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>da <span class="ot">&lt;-</span> <span class="fu">query_gesla</span>(<span class="at">country =</span> <span class="st">"IRL"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ This process can take some time, as it depends on the size of the final dataset, and on</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; internet connection.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>ℹ Connecting to the data server... [K</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>✔ Connecting to the data server... [<span class="fl">3.5</span>s] [K</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>ℹ Filtering data. This can take some time... [K</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>✔ Filtering data. This can take some time... [2m <span class="fl">43.4</span>s] [K</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>ℹ Query finished. [K</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>✔ Query finished. [13ms] [K</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>da</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Table</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16321218 rows x 13 columns</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $date_time &lt;timestamp[us]&gt;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $year &lt;int64&gt;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $month &lt;int64&gt;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $day &lt;int64&gt;</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $hour &lt;int64&gt;</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $country &lt;string&gt;</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $site_name &lt;string&gt;</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $lat &lt;double&gt;</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $lon &lt;double&gt;</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $sea_level &lt;double&gt;</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $qc_flag &lt;int64&gt;</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $use_flag &lt;int64&gt;</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $file_name &lt;string&gt;</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; See $metadata for additional Schema metadata</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(da)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 16321218       13</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(da)</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [1] "date_time" "year"      "month"     "day"       "hour"      "country"  </span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  [7] "site_name" "lat"       "lon"       "sea_level" "qc_flag"   "use_flag" </span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13] "file_name"</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(da)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "Table"        "ArrowTabular" "ArrowObject"  "R6"</span></span></code></pre></div>
<p>This is also an <code>ArrowObject</code> object, and works the same
way as any other Arrow object type, i.e., it can be manipulated with
<strong>dplyr</strong> verbs. By the end of this section we will show
some examples.</p>
<p>Many other queries can be made, for example,</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Select one specific year</span></span>
<span><span class="va">da</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gesla.html">query_gesla</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"IRL"</span>, year <span class="op">=</span> <span class="fl">2015</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Multiple years</span></span>
<span><span class="va">da</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gesla.html">query_gesla</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"IRL"</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2015</span>, <span class="fl">2017</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">da</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gesla.html">query_gesla</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"IRL"</span>, year <span class="op">=</span> <span class="fl">2010</span><span class="op">:</span><span class="fl">2017</span><span class="op">)</span></span>
<span><span class="va">da</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gesla.html">query_gesla</a></span><span class="op">(</span>country <span class="op">=</span> <span class="st">"IRL"</span>, year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2010</span>, <span class="fl">2012</span>, <span class="fl">2015</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Multiple countries</span></span>
<span><span class="va">da</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gesla.html">query_gesla</a></span><span class="op">(</span>country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IRL"</span>, <span class="st">"ATA"</span><span class="op">)</span>, year <span class="op">=</span> <span class="fl">2015</span><span class="op">)</span></span>
<span><span class="va">da</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query_gesla.html">query_gesla</a></span><span class="op">(</span>country <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IRL"</span>, <span class="st">"ATA"</span><span class="op">)</span>, year <span class="op">=</span> <span class="fl">2010</span><span class="op">:</span><span class="fl">2017</span><span class="op">)</span></span></code></pre></div>
<p>As one last example, we may be interested in data only for the site
<code>Dublin_Port</code> in Ireland, and for the years 2015 and 2017.
This query would be done as follows</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>da <span class="ot">&lt;-</span> <span class="fu">query_gesla</span>(<span class="at">country =</span> <span class="st">"IRL"</span>, <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2015</span>, <span class="dv">2017</span>),</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">site_name =</span> <span class="st">"Dublin_Port"</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ℹ This process can take some time, as it depends on the size of the final dataset, and on</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; internet connection.</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ℹ Connecting to the data server... [K</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>✔ Connecting to the data server... [<span class="fl">3.4</span>s] [K</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>ℹ Filtering data. This can take some time... [K</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>✔ Filtering data. This can take some time... [2m 34s] [K</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>ℹ Query finished. [K</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>✔ Query finished. [21ms] [K</span></code></pre></div>
<p>Now we could explore this subset using <strong>dplyr</strong> verbs
as usual</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Verifying number of observations per year</span></span>
<span><span class="va">da</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 2</span></span>
<span><span class="co">#&gt;    year      n</span></span>
<span><span class="co">#&gt;   &lt;int&gt;  &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1  2015  93790</span></span>
<span><span class="co">#&gt; 2  2017 104835</span></span>
<span></span>
<span><span class="co">## Calculating summary statistics per year</span></span>
<span><span class="va">da</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>        min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">sea_level</span><span class="op">)</span>,</span>
<span>        mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">sea_level</span><span class="op">)</span>,</span>
<span>        max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">sea_level</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span><span class="co">#&gt;    year   min    mean   max</span></span>
<span><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  2015 -2.62 -0.0104  2.38</span></span>
<span><span class="co">#&gt; 2  2017 -2.43  0.0762  2.53</span></span></code></pre></div>
<p>Note the use of the <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">dplyr::collect()</a></code> function at the end
of each call. This is necessary to convert the final result (which is
processed by Arrow) to a common R object (usually a <code>tibble</code>
or similar).</p>
<p>As stated before, the queries made by <code><a href="../reference/query_gesla.html">query_gesla()</a></code> may
take some time to process. To avoid repeating this query in every new
session, you can save this object in a file locally, so it will be
available instantly the next time you may need it. To achieve this, you
can use the <code><a href="../reference/write_gesla.html">write_gesla()</a></code> function</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/write_gesla.html">write_gesla</a></span><span class="op">(</span><span class="va">da</span><span class="op">)</span></span></code></pre></div>
<p>In this case, this call will create a file named
<code>gesla-data.parquet</code>, and it will be ready for reading at any
time, without the need for querying again. At any time, just use</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">da</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_gesla.html">read_gesla</a></span><span class="op">(</span><span class="st">"gesla-data.parquet"</span><span class="op">)</span></span></code></pre></div>
<p>to make it available again.</p>
<p>Please, do not try to save this object as a standard R file, such as
<code>.rds</code> or <code>.rda</code>, as using <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code>
or <code><a href="https://rdrr.io/r/base/save.html" class="external-link">save()</a></code> for example. In this case the resulting saved
object will not be the same as the original object, as an
<code>ArrowObject</code> object is not a standard R object (it actually
is just a pointer to an Arrow style object).</p>
<p>The <code><a href="../reference/query_gesla.html">query_gesla()</a></code> function also has two more arguments.
The <code>use_flag = 1</code> means that only the data suggested by the
GESLA team as being useful for analysis must be used. Please see the <a href="https://gesla787883612.wordpress.com/format/" class="external-link">GESLA format</a>
page for more information. The other argument,
<code>as_data_frame = FALSE</code> specifies if the resulting object
should be an <code>ArrowObject</code> (the default) or a
<code>data.frame</code>. We highly recommend to keep this default
option, as the resulting <code>data.frame</code> can be
larger-than-memory, resulting in a memory overflow or even an R session
crash. Keeping the object as an <code>ArrowObject</code> will always
guarantee that the resulting query will be made available. In any case,
an <code>ArrowObject</code> can always be converted to a
<code>data.frame</code>, if that is desired, without the need to repeat
the query with <code>as_data_frame = TRUE</code>. For example, the
object <code>da</code> created above (which is an
<code>ArrowObject</code>) may be converted to a <code>data.frame</code>
with</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">da</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Table"        "ArrowTabular" "ArrowObject"  "R6"</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="va">da</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-the-gesla-shiny-app">Using the GESLA Shiny app<a class="anchor" aria-label="anchor" href="#using-the-gesla-shiny-app"></a>
</h2>
<p>The GESLA Shiny app (geslaR-app) was developed as a user-friendly
interface to explore the whole GESLA dataset. The app may be called
simply as</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run_gesla_app.html">run_gesla_app</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>This will create a directory called <code>gesla-app</code> on the
current working directory, containing the necessary files for the app
itself, and a sub-directory called <code>gesla_dataset</code> containing
all the GESLA dataset files (as <code>.parquet</code> files, as this is
done with the <code><a href="../reference/download_gesla.html">download_gesla()</a></code> function as explained
above). Note that the first time this function is called, it will create
these directories and download the full GESLA dataset. However, once
this is done, the next time this function is called on this working
directory, only the app will open in the default browser (no more
downloads will be necessary).</p>
<p>This web-interface allows the user to apply some basic filters, by
choosing countries, years and sites. By doing this, the app will filter
the data and show information about the selected subset. The first tab
contains a preview of the selected subset. The two subsequent tabs
provide some plots with the number of observations by year, and summary
plots for the sea level data itself. The last tab will show a map with
the selected locations, and by clicking on the locations, a pop-up will
show information about that specific station.</p>
<!-- Maybe some screenshots here -->
<p>The user has the option to download the selected subset in CSV or
Parquet file formats. We highly recommend to export it as a Parquet
file, as the file size will be much smaller, and it can be simply loaded
into R with the <code><a href="../reference/read_gesla.html">read_gesla()</a></code> function, creating an
<code>ArrowObject</code> object.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Fernando Mayer, Niamh Cahill.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
